<div id="modalNovaPendencia" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            {% csrf_token %}
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="modal-title"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body d-flex flex-column">
                <div class="d-flex flex-column">
                    <label class="pb-1" for="descricao">Descrição</label>
                    <textarea id="descricao" class="form-control"></textarea>
                </div>
                <input id="concluida" class="form-control" type="number" value="0" hidden>
                <input id="cod_ficha" class="form-control" type="number" value="{{ cod_ficha }}" hidden>
            </div>
            <div class="modal-footer">
                <button onclick="salvarPendencia('{% url 'registrar_pendencia' %}', 'modalNovaPendencia')"
                type="button" class="btnCorPrincipal btn">
                    Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<div class="d-flex justify-content-between align-items-center mt-3 mb-4">
    <i class="clicavel font-xlarge bi bi-arrow-left-square-fill" style="color: var(--dark-color);"
       onclick="requisicaoGetPadrao('{% url 'visualizar_ficha' cod_ficha cod_formulario %}')">
    </i>
    <button class="btn btnNovaPendencia" onclick="abrirModalNovaPendencia()">
        Pendência
    </button>
</div>

<div class="pb-3">
    {% if pendencias %}
        {% for pendencia in pendencias %}
            <div class="d-flex mb-3">
                <div class="mt-2">
                    <span class="inicialUsuario rounded-circle
                        {% if pendencia.cod_autor == cod_usuario %}
                        background-letra-inicial-meu-usuario
                        {% else %}
                        background-letra-inicial-outro-usuario
                        {% endif %}
                    ">{{ pendencia.inicial_autor }}</span>
                </div>
                <div class="containerPendencia
                    {% if pendencia.cod_autor == cod_usuario %}
                    borda-esquerda-meu-usuario
                    {% else %}
                    borda-esquerda-outro-usuario
                    {% endif %}
                ">
                    <div class="d-flex justify-content-between">
                        <div class="d-flex">
                            <span class="negrito">{{ pendencia.nome_autor }}</span>

                            {% if pendencia.concluida %}
                                <div class="status mx-1 text-success">
                                    <span class="mx-1">• Concluida</span>
                                    <i class="bi bi-check-circle-fill"></i>
                                </div>
                            {% else %}
                                <div class="status mx-1 text-danger">
                                    <span class="pendencia-aberta mx-1">• Em aberto</span>
                                    <i class="bi bi-exclamation-triangle-fill"></i>
                                </div>
                            {% endif %}

                        </div>
                        <span class="negrito">{{ pendencia.dataHora_cadastro }}</span>
                    </div>
                    <div class="my-3">{{ pendencia.descricao }}</div>

                    {% if pendencia.concluida %}
                        <div class="d-flex justify-content-end">
                            <span class="font-smaller">
                                Concluido por {{ pendencia.nome_concluinte }}
                            </span>
                        </div>
                    {% else %}
                        <div class="d-flex justify-content-end">
                            <button class="btn {% if pendencia.cod_autor == cod_usuario %} btn-minha-pendencia {% else %} btn-pendencia-outro {% endif %}"
                            onclick="requisicaoGetPadrao('{% url 'fechar_pendencia' cod_ficha pendencia.codigo %}')">
                                Fechar
                            </button>
                        </div>
                    {% endif %}

                </div>
            </div>
        {% endfor %}

        {% if status_ficha_aberta == 4 %}
            <div class="d-flex justify-content-center mt-4">
                <button class="btn btnTudoPronto"
                onclick="verificarMudancaEstadoFicha('{% url 'marcar_ficha_preliminar' cod_ficha status_ficha_aberta %}')">
                    Tudo Pronto
                </button>
            </div>
        {% endif %}

    {% else %}
        <div class="d-flex justify-content-center pt-3">
            <span class="negrito font-xlarge">
                Não há pendências para esta ficha!
            </span>
        </div>
    {% endif %}
</div>


















